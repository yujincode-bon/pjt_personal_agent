## 진행할 내용
DAY2에서 수행이 안된건.
- supplement_facts 파서 개발 (텍스트 → 성분/용량 추출)
- Chroma 기반 vector DB 구축 (2-4, 2-2, 2-3 PDF 사용)
- 증상–영양소 매핑 및 조합 룰 JSON 정리

DAY3 에서 수행이 안된건. 
- rda_retriever 노드 구현: PDF RAG에서 권장량/상한량 chunk 검색
- LangGraph 노드 흐름 연결 및 테스트  



## 실제로 한 질문과 내용정리
다음 진행 단계
DAY 2 >> DAY 3까지 실행하기. 
goal_based_node
증상 → 주요 성분 매핑 → 설명에 성분 포함된 제품 필터
🔍 정확 추천 (symbolic)
recommendation_node
증상 텍스트 → FAISS 벡터 검색으로 연관 제품 찾기
🤖 유사도 기반 추천 (semantic)

추가하고 싶은 프로프트

시나리오1. 나이+ 성별 +현재 복용중인 양제의 양 ->겪는 증상 --> "나이와 성별을 고려하여 하루권장 섭취량을 파악" >  섭취량 평가 (과다/부족)> 섭취량 기반 영양제 선출 > 겪고 있는 증상을 합쳐서 겪는 증상과 관련된 키워드를 가진 영양제 선별하여 리뷰 평점 순으로 추천 

시나리오2. 나이+ 성별 +현재 복용중인 양제의 양 ->겪는 증상 --> "나이와 성별을 고려하여 하루권장 섭취량을 파악" >  섭취량 평가 (과다/부족)> 섭취량 기반 영양제 선출 > 겪는 증상과 매칭되는 성분을 가진 영양제를 추천(goal_based_node). ++ 현재 복용중인 영양제와 조합이 좋은 영양 성분 가진 상품을 추천

시나리오3. 아예 "비타민 C" 성분을 가진 영양제를 추천해줘 라고 하면 바로 평점순으로 해당 성분을 가진 영양제 추천하기 

시나리오4. 지금 섭취중인 영양제와 조합이 좋은 영양제를 추천해줘> 그러면 조합이 좋은 영양 성분을 가진 상품중에서 해당 성분 함량이 높은 순으로 추천  혹은 리뷰가 좋은 순으로추천(유력)


정확하게 짚으셨어요! 👏 현재 라우터를 사용하지 않았기 때문에, LangGraph의 흐름은 고정된 순차적 방식으로 동작합니다. 질문하신 것을 바탕으로 지금의 흐름을 정확히 정리해드릴게요:

⸻

✅ 현재 LangGraph 흐름 (라우터 없이 작동)

goal_based_node → recommendation_node → intake_check_node → combination_node → combination_prompt_node


⸻

🔍 각 노드의 역할 (요약)

노드	역할	추천 방식
goal_based_node	증상 → 주요 성분 매핑 → 설명에 성분 포함된 제품 필터	🔍 정확 추천 (symbolic)
recommendation_node	증상 텍스트 → FAISS 벡터 검색으로 연관 제품 찾기	🤖 유사도 기반 추천 (semantic)


⸻

❓ “결국 추천된 제품 2개는 어느 노드를 참고한 결과인가?”

답변:

✅ recommendation_node의 결과입니다.

⸻

이유:
	•	현재 goal_based_node는 상태에 goal_based_recommendations 라는 키로 저장하고,
	•	recommendation_node는 recommendations 라는 키에 최종 추천 리스트를 덮어씌우고 있어요.

따라서:

state["recommendations"] = matched  # <- recommendation_node.py에서 최종 저장


⸻

📌 참고: 현재 코드 흐름 예시

# goal_based_node.py
state["goal_based_recommendations"] = matched  # 따로 저장
state["recommendations"] = matched  # 일단 저장 → recommendation_node에서 덮어쓰기 됨

# recommendation_node.py
state["recommendations"] = top_recommendations  ✅ 최종 이 값만 사용됨


⸻

🔧 해결 방법 (선택지)

선택지	설명	장점
✅ 라우터 도입	recommendation_mode = “precise”일 경우에만 goal_based_node 실행	각 방식 구분 가능
✅ 추천 결과 분리	goal_based_recommendations, semantic_recommendations로 구분 저장	병렬 비교 가능
✅ 결과 합치기	두 결과를 합쳐서 상위 5개 선택 (중복 제거 포함)	정확 + 유사도 혼합 추천 가능


⸻

✅ 요약 정리

질문	답변
현재 추천 제품은 어떤 노드 기반인가요?	🔹 recommendation_node
goal_based_node의 결과는 쓰이고 있나요?	🔸 쓰이긴 하지만 덮어씌워짐
해결하려면 어떻게 해야 하나요?	🔹 라우터 또는 결과 구분 저장이 필요


⸻

필요하시다면, 위 선택지 중 하나를 기준으로 구조 개선도 바로 도와드릴 수 있어요! 😎


## 오후 3시 15분 기준 수행 중인 작업. 
지금 "brand": "Phillips",
    "supplement_facts": [
      {
        "name": "Daily ValueMagnesium",
        "amount": 500.0,
        "unit": "mg",
        "raw_line": "Supplement FactsServing Size: 1 Caplet Amount Per Serving%Daily ValueMagnesium 500 mg119%"
      } 와 같이 제품에 어떤 성분이 들어있는지도 감지를 하고 있는거야? 

내가 원하는 것은 현재 복용중인 성분이 vitamin c라면 조합이 좋은 iron 과 관련된 영양제를 추천해 주는 것, 그리고 비타민 c 섭취량이 권장량보다 적다면 또다른 비타민 c 제품도 추천해 주는것인데.




좋아요 유진님, 아주 중요한 질문이에요. 지금 설명해주신 목표를 제대로 구현하려면 현재 시스템의 작동 방식과 원하시는 로직 차이점을 명확히 짚고 넘어가야 해요.

⸻

🧩 현재 시스템 구조 요약

현재 LangGraph 에이전트는 다음과 같이 작동해요:

🔹 1. 사용자 정보 입력

"profile": {
    "symptoms": ["피로", "수면장애"],
    "current_intake": [
        {"name": "Vitamin C", "amount": 1000, "unit": "mg"}
    ]
}

🔹 2. 추천 방식
	•	goal_based_node: 증상 ➝ 추천 성분 ➝ 제품 설명에 해당 성분 포함 여부 검색
	•	recommendation_node: 증상 텍스트 ➝ 벡터 검색 (FAISS)
	•	결과: 제품 description에서 "Vitamin C" 같은 키워드 포함 여부로 필터링

🔹 3. 조합 노드 (combination_node)
	•	현재 복용 성분 + 추천 제품 설명에 포함된 성분을 기준으로 조합 분석
	•	GOOD_COMBOS, BAD_COMBOS 기준에 따라 좋은/나쁜 조합 판단
	•	단, 제품의 정확한 성분은 아직 supplement_facts에서 파싱 안됨

⸻

⚠️ 문제: 지금은 supplement_facts를 감지하지 않고 있어요

지금은 "description"에 "vitamin c" 같은 단어가 포함되면 감지하는 방식이라:
	•	"Vitamin C"와 **좋은 조합인 "Iron"**을 감지하려면 제품 설명에 "iron"이 명시되어 있어야 해요.
	•	하지만 supplement_facts에만 "Iron"이 있는 경우 → 지금은 놓치고 있어요.

⸻

✅ 유진님이 원하는 목표

정리해보면 다음과 같은 고급 로직이 필요해요:

⸻

🎯 1. 좋은 조합 기반 추가 추천

예시: 사용자가 "Vitamin C"를 복용 중이면,
→ "Iron"을 포함한 제품도 추가로 추천해줘야 함

🎯 2. 부족한 섭취량 보충 추천

예시: 사용자가 "Vitamin C"를 1000mg 먹고 있는데 RDA가 2000mg이면
→ "Vitamin C" 제품을 추가로 추천

⸻

🔧 해결 방향

✅ 1. supplement_facts 파싱 시스템 구축
	•	지금은 description만 보지만,
	•	"supplement_facts"를 다음과 같이 파싱해야 해요:

[
  {
    "name": "Vitamin C",
    "amount": 500.0,
    "unit": "mg"
  },
  {
    "name": "Iron",
    "amount": 15.0,
    "unit": "mg"
  }
]

👉 이걸 기반으로 정확한 성분 리스트를 구성하고,
👉 중복 성분, 부족한 성분, 조합 성분을 판단 가능하게 만들어야 해요.

⸻

✅ 2. 조합 기반 추천 노드 신설 제안

# 조합 추천 노드 구조 (예시)
def combo_recommendation_node(state: AgentState):
    current_nutrients = [clean(n["name"]) for n in state["profile"]["current_intake"]]
    
    recommended_combo_nutrients = []
    for user_nutrient in current_nutrients:
        for a, b in GOOD_COMBOS:
            if user_nutrient == a:
                recommended_combo_nutrients.append(b)
            elif user_nutrient == b:
                recommended_combo_nutrients.append(a)

    # 제품 전체 검색 → 해당 combo 성분이 포함된 것 추천


⸻

✅ 3. 섭취량 부족 감지 → 보충 추천 노드

def rda_fill_node(state: AgentState):
    # 현재까지의 total 섭취량 vs RDA 비교
    # 부족한 영양소는 state["rda_deficient"]에 기록
    # → 이후 해당 성분 포함 제품 재추천


⸻

📌 결론

항목	현재 구현됨?	개선 필요
제품 설명 기반 성분 감지	✅	보완 필요
supplement_facts 감지	❌	✅ 필요
조합 성분 기반 제품 추천	❌	✅ 필요
부족 섭취량 감지 및 보충 추천	❌	✅ 필요


⸻

💬 다음 스텝 추천
	1.	supplement_facts 파싱 → 제품 성분 리스트 추출
	2.	조합 추천 노드 / 부족 보충 노드 설계
	3.	추천 기준 다중화 (사용자 목표 + 보충 필요 + 조합 기반)

⸻

필요하시면 우선 1번: supplement_facts 파싱 시스템 먼저 구현해드릴게요.
진행할까요? 😊
