# 섭취량 초과/ 중복 감지노드(intake_check_node) 개발
## 목표
완벽해요 유진님! 👏
이제 2일차 8시간 동안 어떤 일을 할지 LangGraph 기반 에이전트 2단계 일정을 구체적으로 정리해드릴게요.

⸻

✅ 맞춤형 영양제 추천 에이전트: 2일차 작업 계획 (총 8시간)

🎯 주제: 섭취량 초과/중복 감지 노드 (intake_check_node) 개발

⸻

⏰ 오늘 목표 요약

구분	목표
🎯 주요 목표	사용자의 현재 복용 성분 + 추천 제품 성분을 합산하여 1일 권장량(RDA/UL) 초과 여부 감지
💡 부가 목표	LangGraph 노드화하여 경고 메시지를 출력 + 상태에 저장 (state.warnings)


⸻

✅ 2일차 상세 일정 (총 8시간 기준)

시간	작업 내용	담당 파일
1H	기존 LangGraph 복습 및 state.py 확장 (current_intake, warnings 필드 추가)	state.py
2H	intake_check_node.py 노드 생성 및 LangGraph 연결	nodes/intake_check_node.py, agent.py
2H	영양 성분 권장량 기준(RDA/UL) 정의 (내장 딕셔너리 활용) + 단위 변환 함수 작성	nodes/intake_check_node.py
1H	사용자 복용 성분 + 추천 제품 성분 파싱 및 합산 로직 구현	↑
1H	합산 결과 vs 권장량 비교 → 초과 여부 판단 로직 구현	↑
1H	감지 결과를 state["warnings"]로 저장 + 사용자 피드백 포맷 구성	↑
(여유)	테스트: 여러 current_intake 조합 + 추천 조합 → 경고 시나리오 시뮬레이션	agent.py


⸻

✅ 예상 흐름 (LangGraph 시각화)

[사용자 입력]
    ↓
recommendation_node
    ↓
intake_check_node  ← 오늘 완성할 부분!
    ↓
[초과/중복 감지 결과 → state.warnings]


⸻

✅ 출력 예시 (목표 결과)

✅ 추천 결과:
1. XYZ 멀티비타민 - 비타민 C 500mg, 아연 15mg

⚠️ 섭취 주의 사항:
- 비타민 C: 현재 섭취량 1000mg + 추천 500mg = 1500mg → UL 초과
- 아연: 현재 섭취량 25mg + 추천 15mg = 40mg → UL 도달


⸻

✅ 준비된 자료 기반

자료	활용 목적
추천 제품 정보	state.recommendations
사용자 복용 정보	state.profile.current_intake
RDA/UL 기준 PDF	핵심 영양소는 dict로 수동 정의 (→ 이후 확장 가능)


⸻

✅ 진행 방식

각 단계별로
	•	설계 → 코드 작성 → 실행 예시 → LangGraph 연결
이 순서로 차근차근 구현할 예정입니다.

⸻

좋은 질문이에요 유진님!
사용자 목표 기반 추천과 현재의 recommendation_node.py는 겉으로는 둘 다 추천 기능을 수행하지만, 작동 방식과 목적이 다릅니다.

⸻

✅ 현재 recommendation_node.py가 하는 일

🔍 핵심 로직:
	•	사용자가 입력한 "증상(symptoms)" 리스트를 FAISS 벡터 검색에 활용
	•	"title + description" 전체 텍스트 중 증상 키워드와 가장 유사한 제품을 추천
	•	단순한 문장 유사도 기반 추천 (Embedding Similarity)

symptoms = ["fatigue", "sleep"]
→ "fatigue" / "sleep"라는 단어가 설명(description)에 잘 녹아 있는 제품을 유사도 순으로 추천


⸻

✅ 사용자 목표 기반 추천이란?

🎯 핵심 차이:
	•	"사용자 증상" → "필요한 성분"으로 매핑된 사전 정의된 기준에 따라
	•	해당 성분을 많이 포함하는 제품을 직접 필터링하여 추천

즉:

단계	설명
1. 증상 입력	예: "집중력 저하", "수면장애"
2. 증상-성분 매핑	"수면장애" → Magnesium, Melatonin
3. 성분 기반 추천	description 안에 "Magnesium" 들어있는 제품 우선 추천
4. + 정렬	평점/리뷰순 정렬까지 포함


⸻

🔍 예시 비교

상황	현재 recommendation_node	사용자 목표 기반 추천
입력	["sleep", "fatigue"]	"집중력 향상"
방식	"sleep" 단어 포함된 description 유사도 비교	"집중력 → Ginkgo Biloba" 매핑, 해당 성분 포함 제품 직접 필터링
설명	벡터 유사도 기반	룰 기반 필터링 + 정렬
한계	비의도적 단어 포함 제품도 추천됨	사전 정의된 증상-성분 연결로 더 정확


⸻

✅ 두 방식 요약

항목	recommendation_node.py	사용자 목표 기반 추천
핵심 원리	벡터 유사도 (FAISS)	증상-성분 매핑 기반
구현 난이도	낮음	중간 (매핑 DB 필요)
정밀도	중간	높음
확장성	LLM 유사도 추천 등 쉽게 붙임	증상 사전 정의 필요


⸻

🤔 어떤 걸 언제 쓰면 좋을까?

목적	추천 방식
유연하게 사용자가 표현한 키워드로 비슷한 제품을 찾고 싶을 때	🔸 recommendation_node.py (FAISS)
정확하게 증상에 대응하는 필수 영양소 기반으로 제품을 추천하고 싶을 때	🔸 "사용자 목표 기반 추천"


⸻

✅ 권장 전략

✅ recommendation_node.py는 유지하고
➕ "사용자 목표 기반 추천"은 세부 옵션 선택용 서브 노드로 도입하는 것도 가능해요!

⸻

필요하시면 "사용자 목표 기반 추천 노드 만들어줘"
라고 해주시면 바로 설계 + 코드 드릴게요! 😊💥